#!/bin/bash -eu

test $# = 0 && {
	echo "usage: $0 [user@]host ..."
	exit 2
} >&2

set -x

name="p$$-$RANDOM"

for host in "$@"; do
	cmd="ssh $host"
	test "${others:-}" && tmux new -s "$name" -d "$cmd" || tmux splitw "$cmd" \; selectl tiled
	others=1
done

tmux renamew "$1..{$#}" \; setw synchronize-panes on \; attach -t "$name"
