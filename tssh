#!/bin/bash -eux

if test $# = 0; then
	echo "usage: `basename $0` [user@]host ..." >&2
	exit 2
fi

for host in "$@"; do
	echo "* Connecting '$host'"
	if test "${nonfirst:-}"; then
		tmux neww "ssh $host" || tmux new -d "ssh $host"
		nonfirst=1
	else
		tmux splitw "ssh $host" \; selectl tiled
	fi
done

tmux setw synchronize-panes on \; attach
