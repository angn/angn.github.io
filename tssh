#!/bin/bash -eux

if test $# = 0; then
	echo "usage: `basename $0` [user@]host ..." >&2
	exit 2
fi

for host in "$@"; do
	cmd="ssh $host"
	case ${first:-Y} in
	Y) tmux neww "$cmd" || tmux new -d "$cmd"; first=N ;;
	*) tmux splitw "$cmd" \; selectl tiled ;;
	esac
done

tmux renamew "$1..($#)" \; setw synchronize-panes on \; attach
